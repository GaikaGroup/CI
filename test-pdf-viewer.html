<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 40px;
            background: #fafafa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        button {
            padding: 12px 24px;
            background: #ff9800;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #f57c00;
        }
        .info {
            background: #e3f2fd;
            padding: 16px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .pdf-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }
        .pdf-modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        .pdf-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e5e5;
        }
        .pdf-modal-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }
        .pdf-close-btn {
            padding: 8px 16px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .pdf-modal-body {
            flex: 1;
            overflow: hidden;
        }
        .pdf-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Тест PDF Viewer</h1>
        
        <div>
            <button onclick="testBlobUrl()">Тест 1: Blob URL</button>
            <button onclick="testDataUrl()">Тест 2: Data URL</button>
            <button onclick="testDownload()">Тест 3: Скачать PDF</button>
        </div>

        <div class="info">
            <h3>Информация:</h3>
            <p>Этот тест проверяет различные способы отображения PDF:</p>
            <ul>
                <li><strong>Blob URL:</strong> Конвертирует base64 в blob и создает временный URL</li>
                <li><strong>Data URL:</strong> Использует base64 напрямую (может не работать в iframe)</li>
                <li><strong>Скачать:</strong> Скачивает PDF файл</li>
            </ul>
        </div>
    </div>

    <!-- PDF Modal -->
    <div id="pdfModal" class="pdf-modal-overlay hidden" onclick="closePdfViewer()">
        <div class="pdf-modal-content" onclick="event.stopPropagation()">
            <div class="pdf-modal-header">
                <h3 class="pdf-modal-title" id="pdfTitle">PDF Document</h3>
                <button class="pdf-close-btn" onclick="closePdfViewer()">✕ Закрыть</button>
            </div>
            <div class="pdf-modal-body">
                <iframe id="pdfIframe" class="pdf-iframe"></iframe>
            </div>
        </div>
    </div>

    <script>
        // Простой PDF (минимальный валидный PDF)
        const simplePdfBase64 = 'JVBERi0xLjQKJeLjz9MKMyAwIG9iago8PC9UeXBlL1BhZ2UvUGFyZW50IDIgMCBSL1Jlc291cmNlczw8L0ZvbnQ8PC9GMSA1IDAgUj4+Pj4vTWVkaWFCb3hbMCAwIDYxMiA3OTJdL0NvbnRlbnRzIDQgMCBSPj4KZW5kb2JqCjQgMCBvYmoKPDwvTGVuZ3RoIDQ0Pj4Kc3RyZWFtCkJUCi9GMSA0OCBUZgoxMCA3MDAgVGQKKEhlbGxvIFdvcmxkKSBUagpFVAplbmRzdHJlYW0KZW5kb2JqCjUgMCBvYmoKPDwvVHlwZS9Gb250L1N1YnR5cGUvVHlwZTEvQmFzZUZvbnQvVGltZXMtUm9tYW4+PgplbmRvYmoKMiAwIG9iago8PC9UeXBlL1BhZ2VzL0tpZHNbMyAwIFJdL0NvdW50IDE+PgplbmRvYmoKMSAwIG9iago8PC9UeXBlL0NhdGFsb2cvUGFnZXMgMiAwIFI+PgplbmRvYmoKNiAwIG9iago8PC9Qcm9kdWNlcihQREYgVGVzdCkvQ3JlYXRpb25EYXRlKEQ6MjAyNDAxMDEpPj4KZW5kb2JqCnhyZWYKMCA3CjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDI1NiAwMDAwMCBuIAowMDAwMDAwMjA3IDAwMDAwIG4gCjAwMDAwMDAwMDkgMDAwMDAgbiAKMDAwMDAwMDEyNyAwMDAwMCBuIAowMDAwMDAwMTg2IDAwMDAwIG4gCjAwMDAwMDAzMDUgMDAwMDAgbiAKdHJhaWxlcgo8PC9TaXplIDcvUm9vdCAxIDAgUi9JbmZvIDYgMCBSPj4Kc3RhcnR4cmVmCjM2OAolJUVPRgo=';

        function testBlobUrl() {
            const dataUrl = 'data:application/pdf;base64,' + simplePdfBase64;
            const base64Data = dataUrl.split(',')[1];
            const binaryData = atob(base64Data);
            const bytes = new Uint8Array(binaryData.length);
            for (let i = 0; i < binaryData.length; i++) {
                bytes[i] = binaryData.charCodeAt(i);
            }
            const blob = new Blob([bytes], { type: 'application/pdf' });
            const blobUrl = URL.createObjectURL(blob);
            
            openPdfViewer(blobUrl, 'test-blob.pdf');
        }

        function testDataUrl() {
            const dataUrl = 'data:application/pdf;base64,' + simplePdfBase64;
            openPdfViewer(dataUrl, 'test-data.pdf');
        }

        function testDownload() {
            const dataUrl = 'data:application/pdf;base64,' + simplePdfBase64;
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = 'test-download.pdf';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function openPdfViewer(url, name) {
            document.getElementById('pdfTitle').textContent = name;
            document.getElementById('pdfIframe').src = url;
            document.getElementById('pdfModal').classList.remove('hidden');
        }

        function closePdfViewer() {
            const iframe = document.getElementById('pdfIframe');
            const url = iframe.src;
            if (url.startsWith('blob:')) {
                URL.revokeObjectURL(url);
            }
            iframe.src = '';
            document.getElementById('pdfModal').classList.add('hidden');
        }
    </script>
</body>
</html>

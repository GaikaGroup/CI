# Конфигурация математической модели

## Текущая конфигурация

**Модель для математики:** `gpt-4o`

Эта модель выбрана как лучший баланс между доступностью и качеством решения математических задач.

## Изменения

### 2024 - Обновление модели

- ❌ `gpt-4-turbo-2024-04-09` - решает некоторые задачи неправильно
- ❌ `o1-preview` - недоступна (требуется специальный доступ)
- ✅ `gpt-4o` - текущая модель, хороший баланс

## Как изменить модель

### Через переменную окружения

Создайте или обновите `.env` файл:

```bash
# Для математических задач
VITE_MATH_MODEL=gpt-4o

# Альтернативные варианты:
# VITE_MATH_MODEL=gpt-4-turbo
# VITE_MATH_MODEL=gpt-3.5-turbo  # дешевле, но хуже качество
```

### Через код

Отредактируйте `src/lib/config/math.js`:

```javascript
export const MATH_CONFIG = {
  // ...
  MODEL: import.meta.env.VITE_MATH_MODEL || 'gpt-4o' // Измените здесь
  // ...
};
```

## Доступные модели OpenAI

### Рекомендуемые для математики

1. **gpt-4o** (текущая)
   - ✅ Хорошее качество решений
   - ✅ Доступна всем пользователям OpenAI
   - ✅ Разумная стоимость
   - ⚠️ Может ошибаться в сложных задачах

2. **o1-preview** (если доступна)
   - ✅ Лучшее качество для сложной математики
   - ✅ Chain-of-thought reasoning
   - ❌ Требуется специальный доступ
   - ❌ Дороже (~6x)

3. **gpt-4-turbo**
   - ⚠️ Устаревшая версия
   - ⚠️ Хуже решает математику чем gpt-4o

### Не рекомендуется

- **gpt-3.5-turbo** - слишком много ошибок в математике
- **gpt-4** (базовая) - медленнее и дороже чем gpt-4o

## Улучшенные промпты

Обновлены system prompts для всех категорий математики:

### Ключевые улучшения

1. ✅ **ВНИМАТЕЛЬНО прочитай условие** - акцент на понимание задачи
2. ✅ **ОБЯЗАТЕЛЬНО проверь ответ** - требование верификации
3. ✅ **Найди ВСЕ решения** - для задач с множественными решениями
4. ✅ **Явно укажи финальный ответ** - четкое выделение результата

### Пример промпта (general)

```
Ты - эксперт по математике. При решении задач:
1. ВНИМАТЕЛЬНО прочитай условие и определи, что именно требуется найти
2. Покажи подробное пошаговое решение с объяснением каждого шага
3. Объясни используемые методы и формулы
4. ОБЯЗАТЕЛЬНО проверь правильность ответа, подставив его в исходное условие
5. Если задача имеет несколько решений, найди ВСЕ решения
6. Используй LaTeX для формул (оборачивай в $ или $$)
7. В конце явно укажи финальный ответ
```

## Тестирование

После изменения модели протестируйте на нескольких задачах:

### Тестовые задачи

1. **Алгебра:** Реши уравнение: x² - 5x + 6 = 0
   - Ожидаемый ответ: x = 2 или x = 3

2. **Геометрия:** Найди площадь треугольника со сторонами 3, 4, 5
   - Ожидаемый ответ: 6

3. **Анализ:** Найди производную f(x) = x³ + 2x
   - Ожидаемый ответ: f'(x) = 3x² + 2

## Мониторинг качества

Используйте метрики для отслеживания качества:

```javascript
import { usageTracker } from '$lib/modules/analytics/UsageTracker';

const summary = usageTracker.getMathSummary();
console.log('Math queries:', summary.totalMathQueries);
console.log(
  'Average confidence:',
  summary.categories.map((c) => c.avgConfidence)
);
```

## Локальные модели (альтернатива)

Если хотите использовать локальные модели вместо OpenAI:

```bash
# Установите Ollama
brew install ollama  # macOS
# или скачайте с https://ollama.ai

# Установите математическую модель
ollama pull qwen2.5-math:7b

# Настройте в .env
VITE_MATH_ENABLE_LOCAL_MODELS=true
VITE_OLLAMA_MATH_MODEL=qwen2.5-math:7b
```

### Рекомендуемые локальные модели

1. **qwen2.5-math:7b** - специализированная для математики
2. **deepseek-math:7b** - альтернатива
3. **qwen2.5:14b** - более мощная, но требует больше RAM

## Troubleshooting

### Модель недоступна

```
Error: The model `o1-preview` does not exist or you do not have access to it
```

**Решение:** Используйте `gpt-4o` вместо `o1-preview`

### Плохое качество решений

1. Проверьте, что используется правильная модель (логи показывают `model: "gpt-4o"`)
2. Убедитесь, что temperature = 0.3 (низкая для точности)
3. Проверьте, что maxTokens достаточно (4000 для сложных задач)

### Медленные ответы

- gpt-4o: обычно 10-20 секунд
- Если дольше 30 секунд, проверьте сеть или попробуйте локальную модель

## Стоимость

### GPT-4o (текущая)

- Input: $2.50 / 1M tokens
- Output: $10.00 / 1M tokens
- Средняя задача (4000 tokens): ~$0.04

### o1-preview (если доступна)

- Input: $15.00 / 1M tokens
- Output: $60.00 / 1M tokens
- Средняя задача (4000 tokens): ~$0.24

### Локальные модели

- Бесплатно
- Требуется 8+ GB RAM
- Медленнее (20-40 сек)

## Ссылки

- [Конфигурация математики](../src/lib/config/math.js)
- [Request Enhancer](../src/lib/modules/llm/enhancers/RequestEnhancer.js)
- [Документация по математике](./math-reasoning-enhancement.md)

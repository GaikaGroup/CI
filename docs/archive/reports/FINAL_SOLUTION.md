# Финальное решение

## Проблема

Задачи типа "определите по рисунку" требуют анализа изображения, а не только текста.

## Ошибка

Моя оптимизация (использовать только OCR текст) была неправильной для таких задач.

## Правильное решение

### 1. Всегда использовать vision модель если есть изображение

```javascript
if (images && images.length > 0) {
  // Используем vision модель
  userMessage.content = [
    { type: 'text', text: fullContent },
    { type: 'image_url', image_url: { url: imageData } }
  ];
}
```

### 2. Использовать быструю vision модель

- ❌ llava:7b - очень медленная (6+ минут)
- ✅ minicpm-v:8b - быстрая (1-2 минуты)

## Установка

```bash
# Установить быструю vision модель
ollama pull minicpm-v:8b

# Проверить
ollama list | grep minicpm
```

## Изменения

1. `src/routes/api/chat/+server.js` - убрана неправильная оптимизация
2. `src/lib/config/llm.js` - изменена дефолтная vision модель на minicpm-v:8b

## Результат

Теперь система:

- ✅ Всегда анализирует изображение если оно есть
- ✅ Использует быструю vision модель (minicpm-v вместо llava)
- ✅ Дает конкретные ответы по изображению

## Тест

```bash
node test-real-task.js
```

Ожидаемый результат:

- Время: 1-2 минуты (вместо 6+)
- Модель: minicpm-v:8b
- Ответ: конкретные значения цены деления для каждого прибора

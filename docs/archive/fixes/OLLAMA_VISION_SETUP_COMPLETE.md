# โ ะะฐัััะพะนะบะฐ Ollama Vision - ะะฐะฒะตััะตะฝะพ

## ะงัะพ ะฑัะปะพ ัะดะตะปะฐะฝะพ

ะะพะฑะฐะฒะปะตะฝะฐ ะฟะพะดะดะตัะถะบะฐ ะฑะตัะฟะปะฐัะฝะพะณะพ ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธั ะธะทะพะฑัะฐะถะตะฝะธะน ัะตัะตะท Ollama ั ะผะพะดะตะปัั LLaVA.

## ะะทะผะตะฝะตะฝะธั ะฒ ะบะพะดะต

### 1. ะะพะฑะฐะฒะปะตะฝะฐ ะบะพะฝัะธะณััะฐัะธั vision ะผะพะดะตะปะธ

**src/lib/config/llm.js:**

```javascript
export const OLLAMA_CONFIG = {
  // ...
  VISION_MODEL: import.meta.env.VITE_OLLAMA_VISION_MODEL || 'llava:7b'
  // ...
};
```

### 2. ะะพะฑะฐะฒะปะตะฝะฐ ะปะพะณะธะบะฐ ะฒัะฑะพัะฐ ะผะพะดะตะปะธ

**src/lib/modules/llm/providers/OllamaProvider.js:**

```javascript
// ะัะพะฒะตัะบะฐ ะฝะฐะปะธัะธั ะธะทะพะฑัะฐะถะตะฝะธะน
hasImages(messages) {
  return messages.some(m => {
    if (Array.isArray(m.content)) {
      return m.content.some(c => c.type === 'image_url');
    }
    return false;
  });
}

// ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะฑะพั ะผะพะดะตะปะธ
const needsVision = this.hasImages(messages);
const modelToUse = needsVision ? this.config.VISION_MODEL : options.model;
```

### 3. ะะพะฑะฐะฒะปะตะฝะฐ ะฟะพะดะดะตัะถะบะฐ ัะพัะผะฐัะฐ vision

```javascript
// ะะพะฝะฒะตััะฐัะธั ัะพะพะฑัะตะฝะธะน ะดะปั Ollama
const ollamaMessages = messages.map((m) => {
  if (Array.isArray(m.content)) {
    const textParts = m.content.filter((c) => c.type === 'text').map((c) => c.text);
    const imageParts = m.content.filter((c) => c.type === 'image_url');

    return {
      role: m.role,
      content: textParts.join('\n'),
      images: imageParts.map((img) => img.image_url.url)
    };
  }

  return { role: m.role, content: String(m.content) };
});
```

## ะฃััะฐะฝะพะฒะบะฐ ะฝะฐ ัะตัะฒะตัะต

### ะจะฐะณ 1: ะฃััะฐะฝะพะฒะธัะต LLaVA

```bash
# ะะพะดะบะปััะธัะตัั ะบ ัะตัะฒะตัั
ssh user@your-server

# ะฃััะฐะฝะพะฒะธัะต LLaVA 7B (ัะตะบะพะผะตะฝะดัะตััั)
ollama pull llava:7b
```

### ะจะฐะณ 2: ะัะพะฒะตัััะต ัััะฐะฝะพะฒะบั

```bash
ollama list
```

ะะพะปะถะฝะฐ ะฟะพัะฒะธัััั ะผะพะดะตะปั `llava:7b`.

### ะจะฐะณ 3: ะะตัะตะทะฐะฟัััะธัะต ะฟัะธะปะพะถะตะฝะธะต

```bash
# ะ ะดะธัะตะบัะพัะธะธ ะฟัะพะตะบัะฐ
npm run dev
```

## ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั

### ะะพะณะธะบะฐ ะฒัะฑะพัะฐ ะผะพะดะตะปะธ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะะพะปัะทะพะฒะฐัะตะปั ะพัะฟัะฐะฒะปัะตั ัะพะพะฑัะตะฝะธะต   โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ
               โ
               โผ
       โโโโโโโโโโโโโโโโโ
       โ ะััั          โ
       โ ะธะทะพะฑัะฐะถะตะฝะธั?  โ
       โโโโโฌโโโโโโโโฌโโโโ
           โ       โ
       ะะฐ  โ       โ ะะตั
           โ       โ
           โผ       โผ
    โโโโโโโโโโโโ โโโโโโโโโโโโ
    โ llava:7b โ โqwen2.5:7bโ
    โ (vision) โ โ  (text)  โ
    โโโโโโโโโโโโ โโโโโโโโโโโโ
           โ       โ
           โโโโโฌโโโโ
               โ
               โผ
       โโโโโโโโโโโโโโโโโ
       โ ะัะปะธ ะพัะธะฑะบะฐ   โ
       โ โ OpenAI      โ
       โ (fallback)    โ
       โโโโโโโโโโโโโโโโโ
```

### ะัะธะผะตัั:

**ะขะตะบััะพะฒัะน ะฒะพะฟัะพั:**

```
"ะงัะพ ัะฐะบะพะต ัะธะทะธะบะฐ?" โ qwen2.5:7b (ะฑััััะพ, ะฑะตัะฟะปะฐัะฝะพ)
```

**ะะพะฟัะพั ั ะธะทะพะฑัะฐะถะตะฝะธะตะผ:**

```
"ะะตัะธ ะทะฐะดะฐัั" + [ะธะทะพะฑัะฐะถะตะฝะธะต] โ llava:7b (vision, ะฑะตัะฟะปะฐัะฝะพ)
```

**ะัะปะธ llava ะฝะต ัะฐะฑะพัะฐะตั:**

```
"ะะตัะธ ะทะฐะดะฐัั" + [ะธะทะพะฑัะฐะถะตะฝะธะต] โ gpt-4-turbo (fallback, ะฟะปะฐัะฝะพ)
```

## ะขัะตะฑะพะฒะฐะฝะธั

### ะะธะฝะธะผะฐะปัะฝัะต:

- **RAM:** 8 GB
- **ะะธัะบ:** 5 GB ัะฒะพะฑะพะดะฝะพะณะพ ะผะตััะฐ
- **Ollama:** ัััะฐะฝะพะฒะปะตะฝ ะธ ะทะฐะฟััะตะฝ

### ะะตะบะพะผะตะฝะดัะตะผัะต:

- **RAM:** 16 GB
- **GPU:** NVIDIA ั 4+ GB VRAM (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะดะปั ััะบะพัะตะฝะธั)
- **ะะธัะบ:** 10 GB ัะฒะพะฑะพะดะฝะพะณะพ ะผะตััะฐ

## ะขะตััะธัะพะฒะฐะฝะธะต

### 1. ะัะพะฒะตัััะต ัััะฐะฝะพะฒะบั LLaVA

```bash
ollama list
```

**ะะถะธะดะฐะตะผัะน ะฒัะฒะพะด:**

```
NAME            ID              SIZE    MODIFIED
llava:7b        abc123def       4.7 GB  2 minutes ago
qwen2.5:7b      def456ghi       4.4 GB  1 hour ago
```

### 2. ะัะพัะตััะธััะนัะต ะฒ ัะฐัะต

1. ะัะบัะพะนัะต ัะฐั
2. ะะฐะณััะทะธัะต ะธะทะพะฑัะฐะถะตะฝะธะต ั ะทะฐะดะฐัะตะน 20
3. ะัะฟัะฐะฒััะต "ะะตัะธ ะทะฐะดะฐัั"
4. ะัะพะฒะตัััะต ะปะพะณะธ ัะตัะฒะตัะฐ

**ะะถะธะดะฐะตะผัะต ะปะพะณะธ:**

```
[Ollama] resolved model: llava:7b
Response generated using provider: ollama, model: llava:7b
```

### 3. ะัะพะฒะตัััะต ะพัะฒะตั

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั:**

```
ะะปั ะพะฟัะตะดะตะปะตะฝะธั ัะตะฝั ะดะตะปะตะฝะธั ะบะฐะถะดะพะณะพ ะฟัะธะฑะพัะฐ ะฟะพัะผะพััะธะผ ะฝะฐ ะพัะผะตัะบะธ:

1. ะขะตัะผะพะผะตัั: ะะตะถะดั 39 ะธ 42 ะณัะฐะดััะฐะผะธ ะตััั 5 ะดะตะปะตะฝะธะน
   ะฆะตะฝะฐ ะดะตะปะตะฝะธั = (42 - 39) / 5 = 0.6 ะณัะฐะดััะฐ

2. ะะธะฝะตะนะบะฐ: ะะตะถะดั 5 ะธ 10 ัะผ ะตััั 5 ะดะตะปะตะฝะธะน
   ะฆะตะฝะฐ ะดะตะปะตะฝะธั = (10 - 5) / 5 = 1 ัะผ

3. ะกะตะบัะฝะดะพะผะตั: ะะตะถะดั 950 ะธ 145 ะตััั 20 ะดะตะปะตะฝะธะน
   ะฆะตะฝะฐ ะดะตะปะตะฝะธั = (145 - 950) / 20 = -6.75 ัะตะบัะฝะดั

...
```

## ะะพะฝัะธะณััะฐัะธั ัะตัะตะท .env

```env
# ะขะตะบััะพะฒัะต ะผะพะดะตะปะธ (ะฟะพ ัะผะพะปัะฐะฝะธั)
VITE_OLLAMA_MODELS=qwen2.5:1.5b,qwen2.5:7b

# Vision ะผะพะดะตะปั ะดะปั ะธะทะพะฑัะฐะถะตะฝะธะน
VITE_OLLAMA_VISION_MODEL=llava:7b

# ะะปะธ ะธัะฟะพะปัะทัะนัะต ะดััะณัั vision ะผะพะดะตะปั
# VITE_OLLAMA_VISION_MODEL=bakllava
# VITE_OLLAMA_VISION_MODEL=llava:13b
```

## ะะปััะตัะฝะฐัะธะฒะฝัะต ะผะพะดะตะปะธ

ะัะปะธ `llava:7b` ะฝะต ะฟะพะดัะพะดะธั:

### BakLLaVA (ะฝะฐ ะฑะฐะทะต Mistral):

```bash
ollama pull bakllava
```

```env
VITE_OLLAMA_VISION_MODEL=bakllava
```

### LLaVA 13B (ะฑะพะปะตะต ัะพัะฝะฐั):

```bash
ollama pull llava:13b
```

```env
VITE_OLLAMA_VISION_MODEL=llava:13b
```

### LLaVA-Phi3 (ะฑะพะปะตะต ะฑััััะฐั):

```bash
ollama pull llava-phi3
```

```env
VITE_OLLAMA_VISION_MODEL=llava-phi3
```

## Troubleshooting

### "model not found"

```bash
ollama pull llava:7b
```

### "connection refused"

```bash
# ะัะพะฒะตัััะต Ollama
systemctl status ollama

# ะะปะธ ะทะฐะฟัััะธัะต
ollama serve
```

### "out of memory"

```bash
# ะัะฟะพะปัะทัะนัะต ะฑะพะปะตะต ะปะตะณะบัั ะผะพะดะตะปั
ollama pull llava
```

### ะะตะดะปะตะฝะฝะฐั ัะฐะฑะพัะฐ

- ะัะพะฒะตัััะต, ะธัะฟะพะปัะทัะตััั ะปะธ GPU: `nvidia-smi`
- ะฃะผะตะฝััะธัะต `NUM_CTX` ะฒ ะบะพะฝัะธะณััะฐัะธะธ
- ะัะฟะพะปัะทัะนัะต ะฑะพะปะตะต ะปะตะณะบัั ะผะพะดะตะปั

## ะัะตะธะผััะตััะฒะฐ

โ **ะะตัะฟะปะฐัะฝะพ** - ะะตั ะทะฐััะฐั ะฝะฐ API  
โ **ะะพะบะฐะปัะฝะพ** - ะะฐะฝะฝัะต ะฝะต ััะพะดัั ะฒ ะพะฑะปะฐะบะพ  
โ **ะะฒัะพะผะฐัะธัะตัะบะธ** - ะัะฑะพั ะผะพะดะตะปะธ ะฟะพ ะฝะฐะปะธัะธั ะธะทะพะฑัะฐะถะตะฝะธะน  
โ **Fallback** - OpenAI ะบะฐะบ ะทะฐะฟะฐัะฝะพะน ะฒะฐัะธะฐะฝั  
โ **ะััััะพ** - ะขะตะบััะพะฒัะต ะฒะพะฟัะพัั ะพะฑัะฐะฑะฐััะฒะฐัััั qwen2.5

## ะะพะบัะผะตะฝัะฐัะธั

- `docs/ollama-vision-setup.md` - ะะพะดัะพะฑะฝะฐั ะธะฝััััะบัะธั ะฟะพ ัััะฐะฝะพะฒะบะต

## ะกะปะตะดัััะธะต ัะฐะณะธ

1. **ะฃััะฐะฝะพะฒะธัะต LLaVA ะฝะฐ ัะตัะฒะตัะต:**

   ```bash
   ollama pull llava:7b
   ```

2. **ะะตัะตะทะฐะฟัััะธัะต ะฟัะธะปะพะถะตะฝะธะต**

3. **ะัะพัะตััะธััะนัะต ั ะธะทะพะฑัะฐะถะตะฝะธะตะผ**

4. **ะัะพะฒะตัััะต ะปะพะณะธ** - ะดะพะปะถะฝะฐ ะธัะฟะพะปัะทะพะฒะฐัััั `llava:7b`

ะขะตะฟะตัั ัะธััะตะผะฐ ะฑัะดะตั ะธัะฟะพะปัะทะพะฒะฐัั ะฑะตัะฟะปะฐัะฝัั ะปะพะบะฐะปัะฝัั ะผะพะดะตะปั ะดะปั ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธั ะธะทะพะฑัะฐะถะตะฝะธะน! ๐

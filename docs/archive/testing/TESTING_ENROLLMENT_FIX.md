# Инструкция по тестированию исправления записи на курсы

## Подготовка к тестированию

1. Убедитесь, что база данных запущена:

   ```bash
   ./start-db.sh
   ```

2. Запустите приложение:

   ```bash
   npm run dev
   ```

3. Очистите localStorage в браузере (для чистого теста):
   - Откройте DevTools (F12)
   - Перейдите в Application → Local Storage
   - Удалите все записи или очистите localStorage

## Тестовые сценарии

### Сценарий 1: Запись на новый курс

1. Войдите в систему как студент
2. Перейдите на страницу `/student` или `/catalogue`
3. Найдите курс, на который вы не записаны
4. Нажмите кнопку "Enroll" или "Записаться"
5. **Ожидаемый результат**:
   - Успешная запись на курс
   - Переход на страницу `/learn/{courseId}`
   - Курс появляется в разделе "My Learning"

### Сценарий 2: Повторная попытка записи

1. Войдите в систему как студент
2. Перейдите на страницу `/student` или `/catalogue`
3. Найдите курс, на который вы УЖЕ записаны
4. Попробуйте нажать кнопку записи снова
5. **Ожидаемый результат**:
   - Кнопка должна показывать "Continue Learning" вместо "Enroll"
   - При клике - переход на страницу обучения
   - Никаких ошибок о дублировании

### Сценарий 3: Проверка списка "My Learning"

1. Войдите в систему как студент
2. Перейдите на страницу `/student`
3. Откройте вкладку "My Learning"
4. **Ожидаемый результат**:
   - Отображаются все курсы, на которые вы записаны
   - Показывается прогресс по каждому курсу
   - Статистика (Active Courses, Completed, Total Lessons) корректна

### Сценарий 4: Проверка статистики

1. Войдите в систему как студент
2. Перейдите на страницу `/student`
3. Откройте вкладку "Progress"
4. **Ожидаемый результат**:
   - Отображается корректная статистика:
     - Total Courses
     - Completed
     - Lessons Completed
     - Assessments Taken

### Сценарий 5: Проверка навигации

1. Войдите в систему как студент
2. Запишитесь на курс
3. Перейдите на страницу обучения `/learn/{courseId}`
4. Вернитесь на `/student`
5. Перейдите на `/catalogue`
6. **Ожидаемый результат**:
   - Состояние записи сохраняется между страницами
   - Нет ошибок в консоли
   - Кнопки отображаются корректно

### Сценарий 6: Проверка после перезагрузки

1. Войдите в систему как студент
2. Запишитесь на курс
3. Перезагрузите страницу (F5)
4. **Ожидаемый результат**:
   - Запись на курс сохранилась
   - Курс отображается в "My Learning"
   - Статистика корректна

## Проверка в консоли браузера

Откройте DevTools (F12) и проверьте:

1. **Нет ошибок** в консоли при:
   - Загрузке страницы
   - Записи на курс
   - Навигации между страницами

2. **Network tab**: при записи на курс должен быть запрос:

   ```
   POST /api/enrollments
   Status: 201 Created
   ```

3. **Application → Local Storage**:
   - Не должно быть старых записей `userEnrollments`
   - Данные должны загружаться из API

## Проверка базы данных

Если у вас есть доступ к базе данных:

```sql
-- Проверить записи пользователя
SELECT * FROM enrollments WHERE user_id = 'YOUR_USER_ID';

-- Проверить статус записей
SELECT status, COUNT(*) FROM enrollments GROUP BY status;
```

## Известные проблемы (если они возникнут)

### Проблема: "Failed to join course: User is already enrolled"

**Причина**: Старые данные в localStorage

**Решение**:

1. Откройте DevTools → Application → Local Storage
2. Удалите ключ `userEnrollments`
3. Перезагрузите страницу

### Проблема: Курс не появляется в "My Learning"

**Причина**: Store не обновился

**Решение**:

1. Проверьте Network tab - был ли успешный POST запрос
2. Перезагрузите страницу
3. Проверьте консоль на наличие ошибок

### Проблема: Статистика не обновляется

**Причина**: Derived store не пересчитался

**Решение**:

1. Перезагрузите страницу
2. Проверьте, что данные в базе корректны

## Контрольный список

- [ ] Запись на новый курс работает
- [ ] Повторная запись показывает "Continue Learning"
- [ ] Список "My Learning" отображается корректно
- [ ] Статистика обновляется
- [ ] Навигация работает без ошибок
- [ ] После перезагрузки данные сохраняются
- [ ] Нет ошибок в консоли
- [ ] API запросы успешны (201/200)
- [ ] База данных содержит корректные записи

## Дополнительные проверки

### Для администраторов

1. Создайте новый курс
2. Проверьте, что вы автоматически записаны на него
3. Проверьте список студентов курса

### Для преподавателей

1. Создайте курс
2. Проверьте, что вы записаны как создатель
3. Проверьте доступ к курсу

## Отчет о тестировании

После тестирования заполните:

- **Дата тестирования**: ******\_******
- **Тестировщик**: ******\_******
- **Браузер**: ******\_******
- **Все тесты пройдены**: ☐ Да ☐ Нет
- **Найденные проблемы**: ******\_******
- **Комментарии**: ******\_******

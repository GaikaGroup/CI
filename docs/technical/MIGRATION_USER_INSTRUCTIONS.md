# Инструкции после миграции системы ролей

## Для пользователей

### Если вы видите ошибки аутентификации:

1. **Очистите данные браузера:**
   - Откройте DevTools (F12)
   - Перейдите в Application/Storage
   - Очистите localStorage и cookies для сайта

2. **Или перейдите на страницу очистки:**
   - Откройте `/clear-auth` в браузере
   - Система автоматически очистит старые данные
   - Вы будете перенаправлены на страницу входа

3. **Войдите заново:**
   - Используйте свои обычные учетные данные
   - Система автоматически обновит ваши данные

### Демо-пользователи:

**Администратор:**

- Email: `AdminLogin`
- Password: `AdminPswd`
- Type: Admin + Tutor

**Обычный пользователь:**

- Email: `User1Login`
- Password: `User1Pswd`
- Type: Regular + Student + Tutor

## Для разработчиков

### Что изменилось:

1. **Поле в базе данных:**

   ```sql
   -- Было:
   role VARCHAR(20) DEFAULT 'student'

   -- Стало:
   type VARCHAR(20) DEFAULT 'regular'
   ```

2. **Значения:**
   - `'admin'` → `'admin'` (без изменений)
   - `'student'` → `'regular'`

3. **Новая система ролей:**
   - **Type**: `admin` | `regular` (статический)
   - **Roles**: `Student` | `Tutor` | `Regular` (динамические)

### Автоматическая миграция:

Система автоматически обрабатывает старые cookies:

- Если найдено поле `role`, оно переименовывается в `type`
- Cookie обновляется с новым форматом
- Пользователь может продолжить работу без перелогина

### Очистка данных:

Если автоматическая миграция не работает:

```bash
# Запустить скрипт очистки
node scripts/clear-auth-data.js

# Или направить пользователей на:
/clear-auth
/migration-notice
```

## Проверка работы

1. Откройте `/admin/users`
2. Проверьте отображение колонки "Type & Roles"
3. Убедитесь, что роли отображаются корректно:
   - Admin пользователи: Type=Admin
   - Обычные пользователи: Type=Regular
   - Роли Student/Tutor определяются динамически

## Откат (если нужен)

Если нужно откатить изменения:

```sql
ALTER TABLE users RENAME COLUMN type TO role;
UPDATE users SET role = 'student' WHERE role = 'regular';
```

Затем обновить код, заменив все `type` обратно на `role`.

# Реализация SEO-friendly URL для курсов

## Проблема
Раньше URL курсов использовали только ID:
```
http://localhost:3000/learn/cmgwvky3b00a3duwxipmf24wi
```

Это плохо для SEO и читаемости.

## Решение
Добавлено поле `slug` в модель Course. Теперь URL выглядят так:
```
http://localhost:3000/learn/kak-vospitat-koshku-cmgwvky3b
```

Slug генерируется автоматически из названия курса с поддержкой:
- Кириллицы (транслитерация в латиницу)
- Других языков
- Уникальности (добавляется короткий ID)

## Изменения

### 1. База данных
- Добавлено поле `slug` в таблицу `courses`
- Создан уникальный индекс на `slug`
- Slug обязателен и уникален

### 2. Утилиты
- `src/lib/utils/slugify.js` - генерация slug с транслитерацией
- `src/lib/utils/courseUrl.js` - получение URL курса

### 3. Сервисы
- `CourseService.createCourse()` - автоматически генерирует slug при создании
- `CourseService.getCourseById()` - поддерживает поиск по slug или ID

### 4. Маршруты
- `/learn/[courseId]` - теперь принимает как ID, так и slug
- Все ссылки обновлены для использования slug

## Инструкции по миграции

### Шаг 1: Применить миграцию базы данных
```bash
# Применить миграцию (добавляет колонку slug)
npx prisma migrate dev --name add_course_slug

# Или выполнить SQL напрямую
psql -d your_database -f prisma/migrations/add_course_slug/migration.sql
```

### Шаг 2: Сгенерировать slug для существующих курсов
```bash
node scripts/generate-course-slugs.js
```

Этот скрипт:
1. Найдет все курсы без slug
2. Сгенерирует slug из названия курса
3. Обновит записи в базе данных
4. Добавит уникальное ограничение

### Шаг 3: Обновить Prisma Client
```bash
npx prisma generate
```

### Шаг 4: Перезапустить приложение
```bash
npm run dev
```

## Примеры slug

| Название курса | Slug |
|----------------|------|
| Как воспитать кошку | `kak-vospitat-koshku-abc12345` |
| Learn English | `learn-english-def67890` |
| 日本語を学ぶ | `xue-xi-ghi34567` |
| Curso de Español | `curso-de-espanol-jkl89012` |

## Обратная совместимость

Система поддерживает оба формата URL:
- Новый: `/learn/kak-vospitat-koshku-abc12345` (slug)
- Старый: `/learn/cmgwvky3b00a3duwxipmf24wi` (ID)

Старые ссылки продолжат работать, но новые будут использовать slug.

## SEO преимущества

1. **Читаемые URL** - пользователи видят тему курса в адресной строке
2. **Ключевые слова** - поисковики индексируют слова из URL
3. **Лучший CTR** - пользователи чаще кликают на понятные ссылки
4. **Социальные сети** - красивые превью при шаринге

## Технические детали

### Транслитерация кириллицы
```javascript
а → a, б → b, в → v, г → g, д → d
е → e, ё → yo, ж → zh, з → z, и → i
й → y, к → k, л → l, м → m, н → n
о → o, п → p, р → r, с → s, т → t
у → u, ф → f, х → h, ц → ts, ч → ch
ш → sh, щ → sch, ы → y, э → e, ю → yu, я → ya
```

### Формат slug
- Максимальная длина: 50 символов (+ 9 для ID)
- Формат: `{название}-{короткий-id}`
- Только латиница, цифры и дефисы
- Без пробелов и спецсимволов

### Уникальность
Slug уникален благодаря добавлению короткого ID (первые 8 символов полного ID).

## Тестирование

После миграции проверьте:
1. Создание нового курса генерирует slug
2. Старые URL с ID продолжают работать
3. Новые URL со slug работают
4. Slug корректно отображается в браузере
5. Поиск курсов работает по slug

## Возможные проблемы

### Дубликаты slug
Если два курса имеют одинаковое название, короткий ID обеспечит уникальность.

### Изменение названия курса
Slug НЕ обновляется автоматически при изменении названия. Это сделано намеренно для:
- Сохранения постоянных URL
- Избежания битых ссылок
- SEO стабильности

Если нужно обновить slug, сделайте это вручную через админ-панель.

## Будущие улучшения

1. Редирект со старых URL на новые (301)
2. Админ-панель для ручного редактирования slug
3. История изменений slug
4. Автоматические редиректы при изменении slug

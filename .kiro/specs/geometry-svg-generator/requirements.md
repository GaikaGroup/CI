# Universal Diagram Generator - Requirements

## Overview

Универсальный модуль для автоматической генерации SVG диаграмм и чертежей на основе анализа текста задачи. Система сама определяет что нужно нарисовать и создаёт соответствующее изображение.

## Goals

- **Автоматический анализ** текста задачи и определение необходимости диаграммы
- **Универсальная генерация** - один API для всех типов диаграмм
- **Интеллектуальное извлечение** параметров из текста задачи
- **Качественные диаграммы** с правильными пропорциями и подписями
- **Легкая интеграция** - не изменяет существующую логику

## Non-Goals

- Генерация сложных 3D моделей
- Анимация (на первом этапе)
- Изменение существующей логики сессий и чата
- Ручное указание типа фигуры (всё автоматически)

## Requirements

### Functional Requirements

#### FR1: Универсальный API

```javascript
// Один метод для всего
const result = await DiagramService.generateFromText(taskText);
// Возвращает: { svg, dataURL, type, metadata }
```

#### FR2: Интеллектуальный анализ текста

- Автоматическое определение типа задачи (геометрия, графики, схемы)
- Извлечение всех параметров из текста
- Поддержка русского и английского языка
- Обработка различных форматов записи (50°, 50 градусов, пятьдесят градусов)

#### FR3: Поддерживаемые типы диаграмм

**Геометрия:**

- Треугольники (любые типы)
- Четырехугольники
- Окружности
- Углы
- Комбинированные фигуры

**Графики (будущее):**

- Функции
- Координатная плоскость

#### FR4: Автоматические аннотации

- Система сама определяет что подписывать
- Умное позиционирование меток (без наложений)
- Адаптивный размер шрифтов

#### FR5: Простая интеграция

```javascript
// В любом месте проекта
import { DiagramService } from '$lib/modules/diagrams';

const diagram = await DiagramService.generateFromText(
  'В треугольнике ABC угол A = 50°, угол B = 70°'
);

if (diagram.success) {
  // Использовать diagram.svg или diagram.dataURL
}
```

### Non-Functional Requirements

#### NFR1: Performance

- Генерация изображения < 100ms
- Минимальное использование памяти

#### NFR2: Quality

- Математически точные чертежи
- Масштабируемость без потери качества (SVG)

#### NFR3: Maintainability

- Модульная архитектура
- Легко добавлять новые фигуры
- Хорошо документированный код

#### NFR4: Integration

- Не изменяет существующий код
- Опциональное использование
- Совместимость с текущей системой

## Use Cases

### UC1: Автоматическая генерация из текста задачи

**Actor:** Система
**Input:** "В треугольнике ABC угол A равен 50 градусам, угол B равен 70 градусам. Найдите угол C."
**Flow:**

1. Анализ текста → определяет "треугольник"
2. Извлечение параметров → A=50°, B=70°
3. Вычисление недостающих → C=60°
4. Генерация SVG с подписями
5. Возврат результата

**Output:**

```javascript
{
  success: true,
  svg: '<svg>...</svg>',
  dataURL: 'data:image/svg+xml;base64,...',
  type: 'triangle',
  metadata: {
    angles: { A: 50, B: 70, C: 60 },
    detected: ['angle A', 'angle B'],
    calculated: ['angle C']
  }
}
```

### UC2: Задача с несколькими фигурами

**Input:** "Дан треугольник ABC, вписанный в окружность радиусом 5 см"
**Flow:**

1. Определяет: треугольник + окружность
2. Извлекает: радиус = 5
3. Генерирует комбинированную диаграмму

### UC3: Обработка ошибок

**Input:** "Треугольник с углами 100°, 100°, 100°"
**Output:**

```javascript
{
  success: false,
  error: 'Невозможно построить треугольник: сумма углов ≠ 180°',
  suggestion: 'Проверьте условие задачи'
}
```

## Technical Constraints

- Только SVG (не Canvas, не PNG)
- Работает на сервере (Node.js)
- Не требует внешних зависимостей для рендеринга
- Совместимо с SvelteKit

## Success Metrics

- Генерация чертежа < 100ms
- 100% математически корректные чертежи
- Поддержка минимум 10 типов фигур
- Покрытие тестами > 80%

## Future Enhancements

- Анимация построения фигур
- 3D геометрия (изометрическая проекция)
- Графики функций
- Координатная плоскость
- Векторы
- Интерактивные чертежи

# Requirements Document

## Introduction

Данная функция создает статистическую панель для AI Tutor Platform по адресу /stats, которая предоставляет администраторам комплексную аналитику и визуализацию данных для принятия управленческих решений. Панель должна показывать ключевые метрики по пользователям, курсам, финансовым затратам на AI, экономике внимания и популярности контента.

## Requirements

### Requirement 1: Создание статистической панели по адресу /stats

**User Story:** Как администратор, я хочу получить доступ к статистической панели по адресу /stats, чтобы анализировать ключевые показатели платформы для принятия управленческих решений.

#### Acceptance Criteria

1. WHEN администратор переходит по адресу /stats THEN система SHALL отображать статистическую панель
2. WHEN администратор находится на /stats THEN система SHALL показывать заголовок "Platform Statistics"
3. WHEN система отображает title страницы THEN система SHALL использовать "Statistics • AI Tutor Platform"
4. WHEN администратор просматривает /stats THEN система SHALL показывать описание "Аналитика и метрики для принятия управленческих решений"
5. WHEN старый адрес /admin используется THEN система SHALL перенаправлять на /stats

### Requirement 2: Статистика пользователей и активности

**User Story:** Как администратор, я хочу видеть статистику пользователей и их активности, чтобы понимать рост и вовлеченность аудитории.

#### Acceptance Criteria

1. WHEN администратор открывает /stats THEN система SHALL отображать общее количество зарегистрированных пользователей
2. WHEN отображается статистика пользователей THEN система SHALL показывать количество новых пользователей за последние 7, 30 дней и год
3. WHEN отображается статистика активности THEN система SHALL показывать количество активных пользователей (с сессиями) за последние 7, 30 дней
4. WHEN отображается статистика активности THEN система SHALL показывать график регистраций пользователей за последние 12 месяцев
5. WHEN отображается статистика активности THEN система SHALL показывать график ежедневной активности за последние 30 дней

### Requirement 3: Статистика курсов и предметов

**User Story:** Как администратор, я хочу видеть статистику по курсам и предметам, чтобы понимать какой контент наиболее популярен и эффективен.

#### Acceptance Criteria

1. WHEN администратор просматривает /stats THEN система SHALL отображать общее количество доступных курсов/предметов
2. WHEN отображается статистика курсов THEN система SHALL показывать количество новых курсов за последние 30 дней
3. WHEN отображается статистика популярности THEN система SHALL показывать топ-10 самых популярных курсов по количеству сессий
4. WHEN отображается статистика популярности THEN система SHALL показывать топ-5 курсов-аутсайдеров (с наименьшим количеством сессий)
5. WHEN отображается статистика курсов THEN система SHALL показывать среднее время, проводимое пользователями в каждом из топ-5 курсов

### Requirement 4: Финансовая аналитика AI-провайдеров

**User Story:** Как администратор, я хочу видеть финансовые затраты на ответы нейросетей, чтобы контролировать расходы и оптимизировать использование AI-провайдеров.

#### Acceptance Criteria

1. WHEN администратор просматривает /stats THEN система SHALL отображать общие затраты на AI-ответы за текущий месяц
2. WHEN отображается финансовая статистика THEN система SHALL показывать затраты за последние 12 месяцев в виде графика
3. WHEN отображается распределение по провайдерам THEN система SHALL показывать круговую диаграмму затрат по OpenAI vs Local LLM
4. WHEN отображается статистика ответов THEN система SHALL показывать общее количество ответов от каждого провайдера
5. WHEN отображается статистика ответов THEN система SHALL показывать среднюю стоимость одного ответа по провайдерам
6. WHEN система записывает данные о расходах THEN система SHALL сохранять их в базу данных для персистентного хранения
7. WHEN сервер перезагружается THEN система SHALL сохранять исторические данные о расходах

### Requirement 5: Экономика внимания - анализ времени пользователей

**User Story:** Как администратор, я хочу видеть как пользователи распределяют свое время между режимами и курсами, чтобы понимать экономику внимания на платформе.

#### Acceptance Criteria

1. WHEN администратор просматривает /stats THEN система SHALL отображать общее время, проведенное пользователями в системе за месяц
2. WHEN отображается экономика внимания THEN система SHALL показывать распределение времени между режимами Fun и Learn в процентах
3. WHEN отображается экономика внимания THEN система SHALL показывать среднее время сессии по режимам (Fun vs Learn)
4. WHEN отображается экономика внимания THEN система SHALL показывать топ-5 курсов по общему времени, проведенному пользователями
5. WHEN отображается экономика внимания THEN система SHALL показывать график среднего времени сессии за последние 30 дней

### Requirement 6: Анализ языкового разнообразия и режимов использования

**User Story:** Как администратор, я хочу видеть статистику использования языков в сессиях и распределение по режимам, чтобы понимать многоязычность платформы и предпочтения пользователей.

#### Acceptance Criteria

1. WHEN администратор просматривает /stats THEN система SHALL отображать общее количество уникальных языков, используемых в сессиях
2. WHEN отображается языковая статистика THEN система SHALL показывать топ-5 самых используемых языков в сессиях с количеством сессий
3. WHEN отображается языковая статистика THEN система SHALL показывать среднее количество языков, которые использует один пользователь
4. WHEN отображается статистика режимов THEN система SHALL показывать распределение сессий между режимами Fun и Learn в процентах
5. WHEN отображается статистика режимов THEN система SHALL показывать среднее количество сообщений в сессии по режимам

### Requirement 7: Тренды и прогнозная аналитика

**User Story:** Как администратор, я хочу видеть тренды развития платформы и прогнозы, чтобы планировать ресурсы и развитие продукта.

#### Acceptance Criteria

1. WHEN администратор просматривает /stats THEN система SHALL отображать тренд роста пользователей (растет/падает/стабилен)
2. WHEN отображается трендовая аналитика THEN система SHALL показывать прогноз количества пользователей на следующий месяц на основе текущего тренда
3. WHEN отображается трендовая аналитика THEN система SHALL показывать сезонность активности пользователей (по дням недели)
4. WHEN отображается трендовая аналитика THEN система SHALL показывать прогноз финансовых затрат на AI на следующий месяц
5. WHEN отображается трендовая аналитика THEN система SHALL показывать индикаторы здоровья платформы (зеленый/желтый/красный) на основе ключевых метрик

### Requirement 8: Фильтрация и временные периоды

**User Story:** Как администратор, я хочу фильтровать статистику по временным периодам, чтобы анализировать данные за конкретные интервалы.

#### Acceptance Criteria

1. WHEN администратор находится на /stats THEN система SHALL предоставлять селектор временных периодов (7 дней, 30 дней, 3 месяца, год)
2. WHEN администратор выбирает временной период THEN система SHALL обновлять все графики и метрики для выбранного периода
3. WHEN администратор выбирает кастомный период THEN система SHALL предоставлять date picker для выбора начальной и конечной даты
4. WHEN изменяется временной период THEN система SHALL сохранять выбор в URL для возможности поделиться ссылкой
5. WHEN загружаются данные для нового периода THEN система SHALL показывать индикаторы загрузки

### Requirement 9: Производительность и кэширование

**User Story:** Как администратор, я хочу чтобы статистическая панель загружалась быстро и не создавала излишнюю нагрузку на систему.

#### Acceptance Criteria

1. WHEN администратор открывает /stats THEN система SHALL загружать основные метрики в течение 3 секунд
2. WHEN система вычисляет сложную аналитику THEN система SHALL кэшировать результаты на 10 минут
3. WHEN система загружает графики THEN система SHALL показывать skeleton loaders во время получения данных
4. WHEN происходит ошибка загрузки данных THEN система SHALL отображать fallback с сообщением об ошибке и кнопкой повтора
5. WHEN система обрабатывает большие объемы данных THEN система SHALL использовать пагинацию или лимиты для оптимизации производительности

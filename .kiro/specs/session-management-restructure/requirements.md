# Requirements Document

## Introduction

Данная спецификация описывает реструктуризацию системы управления сессиями и навигации в приложении. Основные изменения включают: удаление страниц About и Contacts, изменение стартовой страницы на страницу авторизации, реорганизацию системы сессий с уникальными URL, внедрение логики мягкого удаления сессий с разными правами доступа для обычных пользователей и администраторов, а также унификацию терминологии (subject → course, tutor → assistant).

## Архитектура пользователей

Система поддерживает два типа пользователей:
- **User** - обычный пользователь с базовыми правами
- **UserAdmin** - администратор с расширенными правами

Любой пользователь может:
- Создавать Course для себя и других пользователей
- Подписываться (Enroll) на курсы других пользователей
- Отписываться (Drop) от курсов

В каждом курсе используется assistant (ранее tutor) для взаимодействия с пользователями.

## Requirements

### Requirement 1: Удаление страниц About и Contacts

**User Story:** Как администратор системы, я хочу удалить неиспользуемые страницы About и Contacts из главного меню и системы, чтобы упростить навигацию и сосредоточиться на основном функционале.

#### Acceptance Criteria

1. WHEN пользователь открывает главное меню THEN система НЕ ДОЛЖНА отображать пункты "About" и "Contacts"
2. WHEN пользователь пытается перейти по URL страниц About и Contacts THEN система ДОЛЖНА вернуть 404 ошибку или перенаправить на главную страницу
3. WHEN система загружается THEN все файлы и компоненты, связанные со страницами About и Contacts, ДОЛЖНЫ быть удалены из кодовой базы

### Requirement 2: Изменение стартовой страницы

**User Story:** Как пользователь системы, я хочу, чтобы при переходе на главную страницу приложения меня сразу перенаправляло на страницу авторизации, чтобы процесс входа в систему был более прямолинейным.

#### Acceptance Criteria

1. WHEN пользователь переходит на http://localhost:3000/ THEN система ДОЛЖНА автоматически перенаправить его на http://localhost:3000/login
2. WHEN неавторизованный пользователь пытается получить доступ к любой защищенной странице THEN система ДОЛЖНА перенаправить его на страницу авторизации
3. WHEN пользователь успешно авторизуется THEN система ДОЛЖНА перенаправить его на страницу чата/сессий

### Requirement 3: Перенаправление после авторизации

**User Story:** Как авторизованный пользователь, я хочу, чтобы после успешного входа в систему меня автоматически перенаправляло на страницу чата, чтобы сразу начать работу с системой.

#### Acceptance Criteria

1. WHEN пользователь успешно проходит авторизацию THEN система ДОЛЖНА перенаправить его на страницу сессий/чата
2. WHEN пользователь уже авторизован и переходит на страницу логина THEN система ДОЛЖНА перенаправить его на страницу сессий
3. WHEN происходит перенаправление после авторизации THEN система ДОЛЖНА сохранить контекст пользователя (режим FUN/LEARN, выбранный курс)

### Requirement 4: Уникальные URL для сессий

**User Story:** Как пользователь системы, я хочу, чтобы каждая сессия имела свой уникальный URL, чтобы я мог делиться ссылками на конкретные сессии и возвращаться к ним позже.

#### Acceptance Criteria

1. WHEN создается новая сессия THEN система ДОЛЖНА сгенерировать уникальный UUID для сессии
2. WHEN пользователь открывает сессию THEN URL ДОЛЖЕН содержать уникальный идентификатор сессии в формате /sessions/[uuid]
3. WHEN пользователь переходит по прямой ссылке на сессию THEN система ДОЛЖНА открыть соответствующую сессию, если у пользователя есть к ней доступ
4. WHEN пользователь пытается открыть несуществующую сессию THEN система ДОЛЖНА показать ошибку 404
5. WHEN пользователь пытается открыть чужую сессию без прав доступа THEN система ДОЛЖНА показать ошибку доступа

### Requirement 5: Организация сессий по режимам

**User Story:** Как пользователь системы, я хочу, чтобы сессии организовывались по-разному в зависимости от выбранного режима (FUN или LEARN), чтобы лучше структурировать свою работу.

#### Acceptance Criteria

1. WHEN пользователь находится в режиме FUN THEN система ДОЛЖНА отображать все сессии в виде простого хронологического списка
2. WHEN пользователь находится в режиме LEARN THEN система ДОЛЖНА группировать сессии по выбранным курсам (courses)
3. WHEN пользователь переключается между режимами THEN система ДОЛЖНА соответственно изменить отображение списка сессий
4. WHEN пользователь создает новую сессию в режиме LEARN THEN сессия ДОЛЖНА автоматически привязаться к текущему выбранному курсу
5. WHEN пользователь взаимодействует с курсом THEN система ДОЛЖНА использовать assistant (не tutor) для обработки запросов

### Requirement 6: Мягкое удаление сессий в режиме FUN

**User Story:** Как обычный пользователь в режиме FUN, я хочу иметь возможность удалять свои сессии из списка, чтобы поддерживать порядок в интерфейсе, при этом понимая, что данные сохраняются для администраторов.

#### Acceptance Criteria

1. WHEN пользователь находится в режиме FUN THEN у каждой сессии ДОЛЖНА быть кнопка "Удалить"
2. WHEN пользователь нажимает кнопку "Удалить" THEN система ДОЛЖНА показать диалог подтверждения с предупреждением
3. WHEN пользователь подтверждает удаление THEN сессия ДОЛЖНА исчезнуть из его списка сессий
4. WHEN сессия "удалена" пользователем THEN она ДОЛЖНА быть помечена как скрытая в базе данных, но НЕ удалена физически
5. WHEN пользователь пытается открыть "удаленную" сессию по прямой ссылке THEN система ДОЛЖНА показать сообщение о том, что сессия недоступна

### Requirement 7: Запрет удаления сессий в режиме LEARN

**User Story:** Как пользователь в режиме LEARN, я понимаю, что сессии связаны с образовательным процессом и не должны удаляться, чтобы сохранить целостность учебного материала.

#### Acceptance Criteria

1. WHEN пользователь находится в режиме LEARN THEN у сессий НЕ ДОЛЖНО быть кнопки "Удалить"
2. WHEN пользователь пытается удалить сессию в режиме LEARN через API THEN система ДОЛЖНА вернуть ошибку доступа
3. WHEN отображается список сессий в режиме LEARN THEN все сессии ДОЛЖНЫ быть доступны для просмотра без возможности удаления

### Requirement 8: Административный доступ к скрытым сессиям

**User Story:** Как администратор системы, я хочу иметь доступ ко всем сессиям пользователей, включая те, которые они "удалили", чтобы обеспечить полный контроль и возможность восстановления данных.

#### Acceptance Criteria

1. WHEN администратор просматривает сессии пользователя THEN система ДОЛЖНА показывать все сессии, включая скрытые
2. WHEN администратор просматривает скрытую сессию THEN система ДОЛЖНА визуально отмечать ее как скрытую (например, серым цветом или специальной меткой)
3. WHEN администратор хочет восстановить скрытую сессию THEN система ДОЛЖНА предоставить функцию восстановления
4. WHEN администратор восстанавливает сессию THEN она ДОЛЖНА снова появиться в списке сессий пользователя

### Requirement 9: Постоянное хранение сессий

**User Story:** Как администратор системы, я хочу, чтобы все сессии сохранялись в базе данных навсегда без возможности физического удаления через интерфейс, чтобы обеспечить сохранность данных и возможность аудита.

#### Acceptance Criteria

1. WHEN создается любая сессия THEN она ДОЛЖНА сохраняться в базе данных с отметкой времени создания
2. WHEN пользователь "удаляет" сессию THEN в базе данных ДОЛЖНО изменяться только поле видимости, но НЕ происходить физическое удаление
3. WHEN происходит любая операция с сессией THEN система ДОЛЖНА логировать действие для аудита
4. WHEN администратор просматривает статистику THEN система ДОЛЖНА показывать общее количество сессий, включая скрытые

### Requirement 10: Безопасность и права доступа

**User Story:** Как пользователь системы, я хочу быть уверен, что мои сессии защищены и доступны только мне и администраторам, чтобы обеспечить конфиденциальность моих данных.

#### Acceptance Criteria

1. WHEN пользователь пытается получить доступ к сессии THEN система ДОЛЖНА проверить права доступа
2. WHEN пользователь не является владельцем сессии И не является администратором THEN система ДОЛЖНА запретить доступ
3. WHEN происходит попытка несанкционированного доступа THEN система ДОЛЖНА логировать это событие
4. WHEN пользователь выходит из системы THEN все активные сессии чата ДОЛЖНЫ быть корректно завершены

### Requirement 11: Унификация терминологии

**User Story:** Как разработчик системы, я хочу привести терминологию к единому стандарту, заменив "subject" на "course" и "tutor" на "assistant", чтобы обеспечить консистентность кодовой базы.

#### Acceptance Criteria

1. WHEN система обращается к образовательным единицам THEN везде ДОЛЖЕН использоваться термин "course" вместо "subject"
2. WHEN система обращается к AI-помощникам THEN везде ДОЛЖЕН использоваться термин "assistant" вместо "tutor"
3. WHEN происходит миграция терминологии THEN система ДОЛЖНА сохранить обратную совместимость через алиасы
4. WHEN обновляется API THEN все эндпоинты ДОЛЖНЫ использовать новую терминологию
5. WHEN обновляется UI THEN все интерфейсы ДОЛЖНЫ отображать новую терминологию

### Requirement 12: Управление курсами и подписками

**User Story:** Как пользователь системы, я хочу иметь возможность создавать курсы, подписываться на курсы других пользователей и управлять своими подписками, чтобы эффективно организовать обучение.

#### Acceptance Criteria

1. WHEN любой пользователь создает курс THEN система ДОЛЖНА сохранить его как создателя курса
2. WHEN пользователь хочет подписаться на курс THEN система ДОЛЖНА предоставить функцию Enroll
3. WHEN пользователь хочет отписаться от курса THEN система ДОЛЖНА предоставить функцию Drop
4. WHEN пользователь подписан на курс THEN он ДОЛЖЕН иметь доступ к assistant курса
5. WHEN пользователь создает курс для других THEN он ДОЛЖЕН иметь возможность управлять доступом к курсу
6. WHEN пользователь просматривает свои курсы THEN система ДОЛЖНА показывать созданные им курсы и курсы, на которые он подписан

### Requirement 13: Расширение модели базы данных

**User Story:** Как администратор системы, я хочу расширить модель базы данных для поддержки новой функциональности управления сессиями и курсами, чтобы обеспечить полную функциональность системы.

#### Acceptance Criteria

1. WHEN создается сессия THEN в базе данных ДОЛЖНО сохраняться поле courseId для связи с курсом в режиме LEARN
2. WHEN пользователь "удаляет" сессию THEN в базе данных ДОЛЖНО добавляться поле isHidden для мягкого удаления
3. WHEN администратор просматривает сессии THEN система ДОЛЖНА показывать все сессии включая скрытые
4. WHEN создается модель User THEN система ДОЛЖНА поддерживать роли User и UserAdmin
5. WHEN создается модель Course THEN система ДОЛЖНА поддерживать связи с пользователями через подписки
6. WHEN создается модель Enrollment THEN система ДОЛЖНА отслеживать подписки пользователей на курсы
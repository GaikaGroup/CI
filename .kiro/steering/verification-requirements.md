# Verification Requirements - Обязательная проверка работоспособности

## КРИТИЧЕСКОЕ ПРАВИЛО: Проверяй перед завершением

**НИКОГДА не завершай работу без физической проверки результата!**

## ОБЯЗАТЕЛЬНЫЙ ЦИКЛ РАБОТЫ

### Цикл "Выполнение → Проверка → Исправление"

**Каждая задача ДОЛЖНА следовать этому циклу:**

1. **ВЫПОЛНЕНИЕ** - Написать/изменить код
2. **ПРОВЕРКА** - Физически проверить что код работает
3. **АНАЛИЗ РЕЗУЛЬТАТА**:
   - ✅ Если работает корректно → Завершить задачу
   - ❌ Если НЕ работает → Вернуться к шагу 1 (ВЫПОЛНЕНИЕ)

**ЗАПРЕЩЕНО завершать задачу пока проверка не покажет что все работает!**

### Правило "Не верь, проверяй"

- ❌ **НЕПРАВИЛЬНО**: Написал код → "Все готово!" → Создал документацию
- ✅ **ПРАВИЛЬНО**: Написал код → Проверил → Исправил ошибки → Проверил снова → Убедился что работает → "Готово"

### Максимум 2 попытки на проверку

- После написания кода у тебя есть **максимум 2 попытки** на проверку и исправление
- Если после 2 попыток код все еще не работает - сообщи пользователю о проблеме
- **НЕ СКРЫВАЙ** проблемы - лучше признать что нужна помощь, чем сказать "готово" когда не работает

## Обязательный процесс верификации

### 1. После каждого изменения кода

**ЗАПРЕЩЕНО:**

- ❌ Писать "Все готово!" без проверки
- ❌ Создавать документацию до проверки
- ❌ Говорить "Изменения применены" без подтверждения
- ❌ Предполагать что код работает

**ОБЯЗАТЕЛЬНО:**

- ✅ Физически проверить что изменения применились
- ✅ Запустить код и убедиться что он работает
- ✅ Проверить что нет синтаксических ошибок
- ✅ Убедиться что функционал работает как ожидается

### 2. Процесс верификации

#### Шаг 1: Проверка файлов

```bash
# Убедись что файлы созданы/изменены
ls -la path/to/file

# Прочитай файл и проверь содержимое
cat path/to/file
```

#### Шаг 2: Проверка синтаксиса

```bash
# Для JavaScript/TypeScript
npm run lint

# Проверь диагностику
# Используй getDiagnostics tool для проверки ошибок
```

#### Шаг 3: Запуск кода

```bash
# Запусти тесты
npm run test:run

# Если это API - протестируй endpoint
curl http://localhost:5173/api/endpoint

# Если это компонент - запусти dev server и проверь в браузере
npm run dev
```

#### Шаг 4: Проверка функционала

- Выполни действие которое должно работать
- Проверь что результат соответствует ожиданиям
- Проверь edge cases
- Проверь обработку ошибок

### 3. Что проверять для разных типов изменений

#### Новый API endpoint

1. ✅ Файл создан в правильном месте
2. ✅ Нет синтаксических ошибок
3. ✅ Endpoint отвечает на запросы
4. ✅ Возвращает правильный формат данных
5. ✅ Обрабатывает ошибки
6. ✅ Проверяет аутентификацию
7. ✅ Тесты проходят

```bash
# Проверка
curl -X POST http://localhost:5173/api/my-endpoint \
  -H "Content-Type: application/json" \
  -d '{"test": "data"}'
```

#### Новый компонент

1. ✅ Файл создан
2. ✅ Нет синтаксических ошибок
3. ✅ Компонент рендерится
4. ✅ Props работают
5. ✅ События обрабатываются
6. ✅ Стили применяются
7. ✅ Тесты проходят

```bash
# Проверка
npm run dev
# Открой браузер и проверь компонент визуально
```

#### Новый сервис

1. ✅ Файл создан
2. ✅ Нет синтаксических ошибок
3. ✅ Методы работают
4. ✅ Обрабатывает ошибки
5. ✅ Работает с БД корректно
6. ✅ Тесты проходят

```bash
# Проверка
npm run test:run tests/unit/services/MyService.test.js
```

#### Изменение в БД (миграция)

1. ✅ Миграция создана
2. ✅ SQL корректный
3. ✅ Миграция применяется без ошибок
4. ✅ Данные не потеряны
5. ✅ Prisma Client сгенерирован
6. ✅ Код использующий новую схему работает

```bash
# Проверка
npm run db:migrate
npm run db:generate
npm run test:run
```

#### Изменение конфигурации

1. ✅ Файл изменен
2. ✅ Синтаксис корректный (JSON/YAML/JS)
3. ✅ Приложение запускается
4. ✅ Конфигурация применяется
5. ✅ Нет конфликтов

```bash
# Проверка
npm run dev
# Проверь что приложение запустилось без ошибок
```

### 4. Обязательные проверки перед завершением

**Чеклист перед тем как сказать "Готово":**

- [ ] Все файлы созданы/изменены
- [ ] Нет синтаксических ошибок (getDiagnostics)
- [ ] Нет ошибок линтера (npm run lint)
- [ ] Код отформатирован (npm run format)
- [ ] Все тесты проходят (npm run test:run)
- [ ] Функционал работает (физически проверено)
- [ ] Нет console.error в выводе
- [ ] Нет warnings которые нужно исправить
- [ ] Edge cases обработаны
- [ ] Документация обновлена (если нужно)

### 5. Если что-то не работает

**НЕ ЗАВЕРШАЙ РАБОТУ! НИКОГДА!**

**ОБЯЗАТЕЛЬНЫЙ алгоритм при ошибках:**

1. **Признай проблему честно**

   ```
   "❌ Обнаружена ошибка: [точное описание]"
   "Код НЕ работает. Продолжаю исправление."
   ```

2. **Проанализируй причину**

   ```
   "Причина: [детальный анализ]"
   "Что пошло не так: [объяснение]"
   ```

3. **Исправь код**

   ```
   "Исправляю: [конкретные действия]"
   ```

4. **Проверь исправление ФИЗИЧЕСКИ**

   ```
   "Проверяю исправление..."
   [запуск тестов/curl/dev server]
   ```

5. **Оцени результат**
   - ✅ Работает → "✅ Исправление успешно. Проверяю остальные требования..."
   - ❌ Не работает → Вернуться к шагу 2 (максимум 2 итерации)

6. **После 2 неудачных попыток**

   ```
   "После 2 попыток исправления проблема остается:
   [описание проблемы]

   Мне нужна ваша помощь чтобы:
   - [что нужно уточнить]
   - [какая информация поможет]

   Что вы хотите сделать?"
   ```

**ЗАПРЕЩЕНО:**

- ❌ Говорить "готово" если код не работает
- ❌ Скрывать ошибки
- ❌ Делать вид что все хорошо
- ❌ Создавать документацию о "успешной" реализации если есть ошибки
- ❌ Продолжать бесконечно пытаться без обращения к пользователю

### 6. Примеры правильной верификации

#### Пример 1: Создание API endpoint

```
1. Создал файл src/routes/api/courses/+server.js
2. Проверяю синтаксис...
   ✅ getDiagnostics - ошибок нет
3. Проверяю линтер...
   ✅ npm run lint - ошибок нет
4. Запускаю тесты...
   ✅ npm run test:run tests/integration/api/courses.test.js - проходят
5. Тестирую endpoint вручную...
   ✅ curl http://localhost:5173/api/courses - работает
6. Проверяю аутентификацию...
   ✅ curl без cookie - возвращает 401
7. Проверяю валидацию...
   ✅ curl с невалидными данными - возвращает 400

✅ Все проверки пройдены. Endpoint работает корректно.
```

#### Пример 2: Создание компонента

```
1. Создал файл src/lib/components/CourseCard.svelte
2. Проверяю синтаксис...
   ✅ getDiagnostics - ошибок нет
3. Создал тест tests/unit/components/CourseCard.test.js
4. Запускаю тесты...
   ✅ npm run test:run tests/unit/components/CourseCard.test.js - проходят
5. Запускаю dev server...
   ✅ npm run dev - запустился без ошибок
6. Проверяю компонент в браузере...
   ✅ Компонент рендерится
   ✅ Props работают
   ✅ События обрабатываются
   ✅ Стили применяются

✅ Все проверки пройдены. Компонент работает корректно.
```

#### Пример 3: Обнаружение и исправление ошибки

```
1. Создал файл src/lib/services/MyService.js
2. Проверяю синтаксис...
   ❌ getDiagnostics - найдена ошибка: "Missing semicolon on line 15"
3. Исправляю ошибку...
4. Проверяю снова...
   ✅ getDiagnostics - ошибок нет
5. Запускаю тесты...
   ❌ npm run test:run - тест падает: "TypeError: Cannot read property 'id' of undefined"
6. Анализирую ошибку...
   Причина: не проверяется наличие user перед доступом к user.id
7. Исправляю...
8. Запускаю тесты снова...
   ✅ npm run test:run - все тесты проходят
9. Тестирую функционал вручную...
   ✅ Сервис работает корректно

✅ Все проверки пройдены после исправлений. Сервис работает корректно.
```

### 7. Инструменты для верификации

#### getDiagnostics

Используй для проверки синтаксических ошибок:

```javascript
// Проверь файл на ошибки
getDiagnostics({ paths: ['src/lib/services/MyService.js'] });
```

#### npm run lint

Проверка стиля кода:

```bash
npm run lint
```

#### npm run test:run

Запуск всех тестов:

```bash
npm run test:run
```

#### curl

Тестирование API endpoints:

```bash
curl -X GET http://localhost:5173/api/endpoint
curl -X POST http://localhost:5173/api/endpoint -d '{"data": "test"}'
```

#### npm run dev

Запуск dev server для проверки UI:

```bash
npm run dev
# Открой http://localhost:5173 в браузере
```

### 8. Красные флаги - когда точно нужна проверка

- 🚩 Создал новый файл → ПРОВЕРЬ что он создан
- 🚩 Изменил существующий файл → ПРОВЕРЬ что изменения применились
- 🚩 Написал новый код → ПРОВЕРЬ что он работает
- 🚩 Добавил новый функционал → ПРОВЕРЬ что он работает
- 🚩 Исправил баг → ПРОВЕРЬ что баг исправлен
- 🚩 Изменил API → ПРОВЕРЬ что API работает
- 🚩 Изменил компонент → ПРОВЕРЬ что компонент рендерится
- 🚩 Изменил БД → ПРОВЕРЬ что миграция прошла
- 🚩 Изменил конфигурацию → ПРОВЕРЬ что приложение запускается

### 9. Формат отчета о верификации

После каждого изменения предоставь отчет:

```
## Верификация изменений

### Что изменено:
- [список файлов и изменений]

### Проверки:
1. ✅/❌ Синтаксис (getDiagnostics)
2. ✅/❌ Линтер (npm run lint)
3. ✅/❌ Тесты (npm run test:run)
4. ✅/❌ Функционал (ручная проверка)

### Результат:
✅ Все проверки пройдены. Изменения работают корректно.
или
❌ Обнаружены проблемы. Продолжаю исправление...

### Детали проверки:
[подробное описание что и как проверялось]
```

## КРИТИЧЕСКИ ВАЖНЫЕ ПРИНЦИПЫ

### 1. Код который не проверен = код который не работает

**ВСЕГДА предполагай что код может не работать пока не проверишь физически!**

### 2. Цикл обязателен для КАЖДОЙ задачи

```
┌─────────────────────────────────────────┐
│  1. НАПИСАТЬ КОД                        │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│  2. ПРОВЕРИТЬ ФИЗИЧЕСКИ                 │
│     - Запустить                         │
│     - Протестировать                    │
│     - Убедиться что работает            │
└──────────────┬──────────────────────────┘
               │
               ▼
         ┌─────────────┐
         │ Работает?   │
         └─────┬───┬───┘
               │   │
          ДА ──┘   └── НЕТ
          │             │
          ▼             ▼
    ┌─────────┐   ┌──────────────┐
    │ ГОТОВО  │   │ ИСПРАВИТЬ    │
    └─────────┘   │ (макс 2 раза)│
                  └──────┬───────┘
                         │
                         └──────┐
                                │
                  ┌─────────────▼──────────┐
                  │ После 2 попыток:       │
                  │ СПРОСИТЬ ПОЛЬЗОВАТЕЛЯ  │
                  └────────────────────────┘
```

### 3. Честность превыше всего

- ✅ Лучше сказать "Не получилось, нужна помощь"
- ❌ Чем сказать "Готово" когда не работает

### 4. Пользователь не должен быть тестировщиком

**ТЫ проверяешь код. НЕ пользователь.**

- Пользователь дает задачу
- ТЫ пишешь код
- ТЫ проверяешь код
- ТЫ исправляешь ошибки
- ТЫ проверяешь снова
- Только когда ВСЕ работает → говоришь "Готово"

### 5. Время на проверку - это инвестиция

- 5 минут на проверку СЕЙЧАС
- vs
- Часы отладки ПОТОМ (пользователем!)

**Выбор очевиден.**

### 6. Контрольный список перед словами "Готово"

Перед тем как сказать что задача выполнена, ответь на эти вопросы:

- [ ] Я ФИЗИЧЕСКИ запустил код?
- [ ] Я ВИДЕЛ что он работает?
- [ ] Я ПРОВЕРИЛ все требования?
- [ ] Я ПРОТЕСТИРОВАЛ edge cases?
- [ ] Я УБЕДИЛСЯ что нет ошибок?
- [ ] Я ЗАПУСТИЛ тесты и они прошли?
- [ ] Я ГОТОВ показать это пользователю?

**Если хоть один ответ "НЕТ" → НЕ говори "Готово"!**

## Примеры из реальной жизни

### ❌ ПЛОХОЙ пример (так делать НЕЛЬЗЯ):

```
Пользователь: "Добавь API endpoint для создания курса"

Агент: "Создал файл src/routes/api/courses/+server.js
с методом POST. Все готово! ✅"

[Пользователь проверяет - endpoint возвращает 500 ошибку]
[Пользователь тратит час на отладку]
```

### ✅ ХОРОШИЙ пример (так НУЖНО делать):

```
Пользователь: "Добавь API endpoint для создания курса"

Агент: "Создал файл src/routes/api/courses/+server.js
Проверяю синтаксис... ✅
Запускаю линтер... ✅
Тестирую endpoint:
  curl -X POST http://localhost:5173/api/courses \
    -H 'Content-Type: application/json' \
    -d '{"name":"Test","language":"en"}'

Результат: ❌ Ошибка 500 - CourseService is not defined

Исправляю: добавляю import CourseService
Проверяю снова...
Результат: ✅ Endpoint работает, возвращает 201

Запускаю тесты... ✅ Все проходят

✅ Endpoint работает корректно. Задача выполнена."
```

## Финальное напоминание

**В 99% случаев код пишется с ошибками.**

Это нормально. Ошибки - часть процесса.

**НЕ нормально** - отдавать код с ошибками пользователю.

**Твоя задача:**

1. Написать код
2. Найти ошибки САМОСТОЯТЕЛЬНО
3. Исправить ошибки
4. Проверить что все работает
5. ТОЛЬКО ТОГДА сказать "Готово"

**Пользователь не должен проверять твой код. Ты должен проверять свой код.**
